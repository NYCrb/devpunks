#!/usr/bin/env bash

# https://stackoverflow.com/questions/192249/how-do-i-parse-command-line-arguments-in-bash

# for i in `seq 1 10`
#   do
#     echo $i
#   done

menu () {
    echo; echo "Options:"; echo

    echo "  -help                   show brief help"
    echo "  -4k                     Force 3840 x 2160 resolution"
    echo "  -hd                     Force 1920 x 1080 resolution"
    echo "  -input=[file|color]     Input file or color"
    echo "  -letterbox=[color|blur] letterbox color or blurred video matte (defaults to black)"
    echo "    blur                  Blur video as letterbox matte"
    echo "    color values:"
    echo "      random              Random color value"
    echo "      [0x|#]RRGGBB[AA]    Hexidecimal RGB format (with optional 0.0 - 1.0 [AA]lpha value)"
    echo "      color by name       Full color list -> https://ffmpeg.org/ffmpeg-utils.html#toc-Color"

    echo "  -passes=[number]        Number of passes for video"
    echo "  -start=[hh:mm:ss]       start timestamp"
    echo "  -stop=[hh:mm:ss]        stop at timestamp"
    echo "  -stats                  output stats (and time)"
    echo "  -watermark=[file]       Watermark image file"
    echo

    exit 0
}


test $# -eq 0 && menu

for argument in "$@"
  do
    case $argument in

      -help)
        menu
        ;;

      -4k)
        declare -ir WIDTH=3840
        declare -ir HEIGHT=2160
        shift # past argument AND value
        ;;

      -hd)
        declare -ir WIDTH=1920
        declare -ir HEIGHT=1080
        shift # past argument AND value
        ;;

      -input=*)
        declare -r INPUT="${argument#*=}"
        shift # past argument AND value
        ;;

      -letterbox*)
        declare -r MATTE=$( [[ $argument =~ ^-letterbox$ ]] && echo "black" || echo ${argument#*=})
        # shift # past key
        # shift # past value
        shift # past argument AND value
        ;;

      -passes=*)
        declare -r PASSES="${argument#*=}"
        shift # past argument AND value
        ;;

      -start=*)
        declare -r START="${argument#*=}"
        shift # past argument AND value
        ;;

      -stop=*)
        declare -r STOP="${argument#*=}"
        shift # past argument AND value
        ;;

      -stats)
        source $BIN/.stats
        shift # past argument AND value
        ;;

      -watermark=*)
        declare -r WATERMARK="${argument#*=}"
        shift # past argument AND value
        ;;

      -input|-letterbox|-passes|-start|-stop|-watermark)
        echo "$1 requires a value to be set (i.e. $1=value)" >&2; exit 1;;

      -*)
        echo "unknown option: $1" >&2; exit 1;;

      *)
        declare -r OUTPUT="$1"
        ;;
    esac
  done
